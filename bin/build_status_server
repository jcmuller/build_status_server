#!/usr/bin/env ruby

require 'getoptlong'

possible_arguments = [
  ['--config',      '-c', GetoptLong::REQUIRED_ARGUMENT],
  ['--development', '-d', GetoptLong::NO_ARGUMENT],
  ['--help',        '-h', GetoptLong::NO_ARGUMENT],
  ['--verbose',     '-v', GetoptLong::NO_ARGUMENT],
  ['--version',     '-V', GetoptLong::NO_ARGUMENT],
]

opts = GetoptLong.new(*possible_arguments)

options = {}
showhelp = false

def get_version
  require 'build_status_server/version'
  <<-EOV
#{File.basename(__FILE__)}, version #{BuildStatusServer::VERSION}

(c) Juan C. Muller, 2012
http://github.com/jcmuller/build_status_server
  EOV
end

opts.each do |opt, arg|
  case opt
  when '--development'
    $:.push 'lib'
  when '--help'
    puts <<-EOT
Usage: #{File.basename(__FILE__)} [options]

Options:
  -c, --config CONFIGURATION  Specify what configuration file to load
  -d, --development           Development mode. All requirements are loaded from ./lib
  -h, --help                  Display this very helpful text
  -v, --verbose               Be more informative about what's going on
  -V, --version               Print out current version info

#{get_version}
    EOT
    exit
  when '--config'
    options[:config] = arg
  when '--verbose'
    options[:verbose] = true
  when '--version'
    puts get_version
    exit
  end
end

require 'build_status_server'

BuildStatusServer::Server.new(options).listen
